name: Trigger Jenkins Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  trigger-jenkins:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Trigger Jenkins Pipeline
      run: |
        echo "ğŸš€ DÃ©clenchement du pipeline Jenkins..."
        
        # Informations sur le commit
        echo "ğŸ“‹ Commit: ${{ github.sha }}"
        echo "ğŸ“‹ Branche: ${{ github.ref_name }}"
        echo "ğŸ“‹ Auteur: ${{ github.actor }}"
        
        # DÃ©clencher Jenkins via webhook (Ã  configurer dans Jenkins)
        if [ "${{ secrets.JENKINS_WEBHOOK_URL }}" != "" ]; then
          curl -X POST "${{ secrets.JENKINS_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d '{
              "ref": "${{ github.ref }}",
              "sha": "${{ github.sha }}",
              "repository": "${{ github.repository }}",
              "pusher": "${{ github.actor }}"
            }' || echo "âš ï¸ Webhook Jenkins non configurÃ© ou inaccessible"
        else
          echo "â„¹ï¸ URL webhook Jenkins non configurÃ©e dans les secrets"
        fi
        
        echo "âœ… DÃ©clenchement terminÃ©"

  notify:
    runs-on: ubuntu-latest
    needs: trigger-jenkins
    if: always()
    
    steps:
    - name: Notify Status
      run: |
        if [ "${{ needs.trigger-jenkins.result }}" == "success" ]; then
          echo "âœ… Pipeline Jenkins dÃ©clenchÃ© avec succÃ¨s"
        else
          echo "âŒ Ã‰chec du dÃ©clenchement du pipeline Jenkins"
        fi